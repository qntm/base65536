/* eslint-env jest */

import gen from './gen'

describe('gen', () => {
  let generated

  beforeAll(() =>
    gen().then(g => {
      generated = g
    })
  )

  it('generates the correct padding block', () => {
    expect(generated.paddingBlockStart).toBe('á”€')
  })

  it('generates the correct blocks', () => {
    expect(generated.blockStarts).toBe(
      'ã€ã”€ã˜€ãœ€ã €ã¤€ã¨€ã¬€ã°€ã´€ã¸€ã¼€ä€€ä„€äˆ€äŒ€' +
      'ä€ä”€ä˜€äœ€ä €ä¤€ä¨€ä¬€ä°€ä¸€ä¼€å€€å„€åˆ€åŒ€å€' +
      'å”€å˜€åœ€å €å¤€å¨€å¬€å°€å´€å¸€å¼€æ€€æ„€æˆ€æŒ€æ€' +
      'æ”€æ˜€æœ€æ €æ¤€æ¨€æ¬€æ°€æ´€æ¸€æ¼€ç€€ç„€çˆ€çŒ€ç€' +
      'ç”€ç˜€çœ€ç €ç¤€ç¨€ç¬€ç°€ç´€ç¸€ç¼€è€€è„€èˆ€èŒ€è€' +
      'è”€è˜€èœ€è €è¤€è¨€è¬€è°€è´€è¸€è¼€é€€é„€éˆ€éŒ€é€' +
      'é”€é˜€éœ€é €é¤€é¨€é¬€é°€é´€é¸€ê„€êˆ€êŒ€ê”€ð˜€ð’€€' +
      'ð’„€ð’ˆ€ð“€€ð“„€ð“ˆ€ð“Œ€ð”€ð””€ð– €ð–¤€ð €€ð „€ð ˆ€ð Œ€ð €ð ”€' +
      'ð ˜€ð œ€ð  €ð ¤€ð ¨€ð ¬€ð °€ð ´€ð ¸€ð ¼€ð¡€€ð¡„€ð¡ˆ€ð¡Œ€ð¡€ð¡”€' +
      'ð¡˜€ð¡œ€ð¡ €ð¡¤€ð¡¨€ð¡¬€ð¡°€ð¡´€ð¡¸€ð¡¼€ð¢€€ð¢„€ð¢ˆ€ð¢Œ€ð¢€ð¢”€' +
      'ð¢˜€ð¢œ€ð¢ €ð¢¤€ð¢¨€ð¢¬€ð¢°€ð¢´€ð¢¸€ð¢¼€ð£€€ð£„€ð£ˆ€ð£Œ€ð£€ð£”€' +
      'ð£˜€ð£œ€ð£ €ð£¤€ð£¨€ð£¬€ð£°€ð£´€ð£¸€ð£¼€ð¤€€ð¤„€ð¤ˆ€ð¤Œ€ð¤€ð¤”€' +
      'ð¤˜€ð¤œ€ð¤ €ð¤¤€ð¤¨€ð¤¬€ð¤°€ð¤´€ð¤¸€ð¤¼€ð¥€€ð¥„€ð¥ˆ€ð¥Œ€ð¥€ð¥”€' +
      'ð¥˜€ð¥œ€ð¥ €ð¥¤€ð¥¨€ð¥¬€ð¥°€ð¥´€ð¥¸€ð¥¼€ð¦€€ð¦„€ð¦ˆ€ð¦Œ€ð¦€ð¦”€' +
      'ð¦˜€ð¦œ€ð¦ €ð¦¤€ð¦¨€ð¦¬€ð¦°€ð¦´€ð¦¸€ð¦¼€ð§€€ð§„€ð§ˆ€ð§Œ€ð§€ð§”€' +
      'ð§˜€ð§œ€ð§ €ð§¤€ð§¨€ð§¬€ð§°€ð§´€ð§¸€ð§¼€ð¨€€ð¨„€ð¨ˆ€ð¨Œ€ð¨€ð¨”€'
    )
  })

  it('has the right East_Asian_Width properties', () => {
    // All 256 characters in each block have the same East_Asian_Width property.
    // 243 of the blocks are 'W' (wide), the other 13 + 1 are 'N' (neutral,
    // which in effect is narrow). This is significant when considering
    // rendering and wrapping.
    const allBlockStarts = [...generated.blockStarts].map(x => x.codePointAt(0))
    const neutralBlockStarts = [...'á”€ê”€ð˜€ð’€€ð’„€ð’ˆ€ð“€€ð“„€ð“ˆ€ð“Œ€ð”€ð””€ð– €ð–¤€'].map(x => x.codePointAt(0))
    allBlockStarts.forEach(blockStart => {
      for (let i = 0; i < 1 << 8; i++) {
        const codePoint = blockStart + i
        const isInNeutralBlock = neutralBlockStarts
          .some(neutralBlockStart =>
            neutralBlockStart <= codePoint &&
            codePoint < neutralBlockStart + (1 << 8)
          )
        expect(generated.safeCodePoint.eastAsianWidth(codePoint)).toBe(isInNeutralBlock ? 'N' : 'W')
      }
    })
  })
})
